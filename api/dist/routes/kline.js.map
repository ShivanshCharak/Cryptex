{"version":3,"file":"kline.js","sourceRoot":"","sources":["../../src/routes/kline.ts"],"names":[],"mappings":";;;AAAA,2BAA4B;AAC5B,qCAAiC;AACjC,mDAAyD;AAGzD,MAAM,QAAQ,GAAG,IAAI,WAAM,CAAC;IACxB,IAAI,EAAE,UAAU;IAChB,IAAI,EAAE,WAAW;IACjB,QAAQ,EAAE,QAAQ;IAClB,QAAQ,EAAE,aAAa;IACvB,IAAI,EAAE,IAAI;CACb,CAAC,CAAC;AACH,QAAQ,CAAC,OAAO,EAAE,CAAC;AAEN,QAAA,WAAW,GAAU,IAAA,gBAAM,GAAE,CAAC;AAE3C,mBAAW,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE;IAClC,0BAAgB,CAAC,GAAG,CAAC;QACf,MAAM,EAAC,KAAK;QACZ,MAAM,EAAC,eAAe;KACzB,CAAC,CAAA;IACN,MAAM,EAAG,SAAS,EAAE,OAAO,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;IAG1C,IAAI,KAAK,CAAC;IACV,QAAQ,IAAI,EAAE,CAAC;QACX,aAAa;QACb,6EAA6E;QAC7E,aAAa;QACb,KAAK,IAAI;YACL,KAAK,GAAG,8DAA8D,CAAC;YACvE,MAAM;YACV,aAAa;YACb,6EAA6E;YAC7E,aAAa;YACb,WAAW;YACP,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACxD,CAAC;IAED,IAAI,CAAC;QACD,YAAY;QACZ,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,IAAI,CAAC,SAAS,GAAG,IAAc,CAAC,EAAE,IAAI,IAAI,CAAC,OAAO,GAAG,IAAc,CAAC,CAAC,CAAC,CAAC;QAEvH,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAC3B,KAAK,EAAE,CAAC,CAAC,KAAK;YACd,GAAG,EAAE,CAAC,CAAC,MAAM;YACb,IAAI,EAAE,CAAC,CAAC,IAAI;YACZ,GAAG,EAAE,CAAC,CAAC,GAAG;YACV,IAAI,EAAE,CAAC,CAAC,IAAI;YACZ,WAAW,EAAE,CAAC,CAAC,WAAW;YAC1B,KAAK,EAAE,CAAC,CAAC,KAAK;YACd,MAAM,EAAE,CAAC,CAAC,MAAM;YAChB,MAAM,EAAE,CAAC,CAAC,MAAM;SACnB,CAAC,CAAC,CAAC,CAAC;IACT,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC9B,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { Client } from 'pg';\nimport { Router } from \"express\";\nimport { httpTotalRequest } from '@repo/backend/metrics';\n\n\nconst pgClient = new Client({\n    user: 'shivansh',\n    host: 'localhost',\n    database: 'crypto',\n    password: 'shamsher@54',\n    port: 5432,\n});\npgClient.connect();\n\nexport const klineRouter:Router = Router();\n\nklineRouter.get(\"/\", async (req, res) => {\n      httpTotalRequest.inc({\n            method:\"get\",\n            routes:\"api/v1/klines\"\n        })\n    const {  startTime, endTime } = req.query;\n\n\n    let query;\n    switch ('1h') {\n        // case '1m':\n        //     query = `SELECT * FROM klines_1m WHERE bucket >= $1 AND bucket <= $2`;\n        //     break;\n        case '1h':\n            query = `SELECT * FROM klines_1h WHERE  bucket >= $1 AND bucket <= $2`;\n            break;\n        // case '1w':\n        //     query = `SELECT * FROM klines_1w WHERE bucket >= $1 AND bucket <= $2`;\n        //     break;\n        // default:\n            return res.status(400).send('Invalid interval');\n    }\n\n    try {\n        //@ts-ignore\n        const result = await pgClient.query(query, [new Date(startTime * 1000 as string), new Date(endTime * 1000 as string)]);\n\n        res.json(result.rows.map(x => ({\n            close: x.close,\n            end: x.bucket,\n            high: x.high,\n            low: x.low,\n            open: x.open,\n            quoteVolume: x.quoteVolume,\n            start: x.start,\n            trades: x.trades,\n            volume: x.volume,\n        })));\n    } catch (err) {\n        console.log(err);\n        res.status(500).send(err);\n    }\n});\n"]}